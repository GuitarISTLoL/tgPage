<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Form</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Helvetica, Arial, sans-serif;
        background: var(--tg-theme-bg-color, #fff);
        color: var(--tg-theme-text-color, #000);
        padding: 20px;
      }

      .container {
        max-width: 500px;
        margin: 0 auto;
      }

      h1 {
        font-size: 24px;
        margin-bottom: 20px;
        color: var(--tg-theme-text-color);
      }

      .form-group {
        margin-bottom: 16px;
      }

      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: var(--tg-theme-text-color);
      }

      .required {
        color: #e74c3c;
      }

      input,
      textarea {
        width: 100%;
        padding: 12px;
        border: 1px solid var(--tg-theme-hint-color, #ccc);
        border-radius: 8px;
        font-size: 16px;
        background: var(--tg-theme-bg-color, #fff);
        color: var(--tg-theme-text-color, #000);
        transition: border-color 0.3s;
      }

      input:focus,
      textarea:focus {
        outline: none;
        border-color: var(--tg-theme-button-color, #3390ec);
      }

      input.error,
      textarea.error {
        border-color: #e74c3c;
      }

      .error-message {
        color: #e74c3c;
        font-size: 14px;
        margin-top: 4px;
        display: none;
      }

      .error-message.show {
        display: block;
      }

      textarea {
        min-height: 100px;
        resize: vertical;
        font-family: inherit;
      }

      .hint {
        font-size: 14px;
        color: var(--tg-theme-hint-color, #999);
        margin-top: 4px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Fill out the form</h1>

      <form id="mainForm">
        <div class="form-group">
          <label for="name"> Full name <span class="required">*</span> </label>
          <input
            type="text"
            id="name"
            name="name"
            placeholder="Full name"
            required
          />
          <div class="error-message" id="name-error">
            This field is required.
          </div>
        </div>

        <div class="form-group">
          <label for="email"> Email <span class="required">*</span> </label>
          <input
            type="email"
            id="email"
            name="email"
            placeholder="example@email.com"
            required
          />
          <div class="error-message" id="email-error">
            Enter a correct email
          </div>
        </div>

        <div class="form-group">
          <label for="phone"> Phone <span class="required">*</span> </label>
          <input
            type="tel"
            id="phone"
            name="phone"
            placeholder="8 (999) 123-45-67"
            required
          />
          <div class="error-message" id="phone-error">
            Enter a correct phone
          </div>
        </div>

        <div class="form-group">
          <label for="message"> Comment (optional) </label>
          <textarea
            id="message"
            name="message"
            placeholder="Enter your message"
          ></textarea>
          <div class="hint">This field is optional</div>
        </div>
      </form>
    </div>
    <script>
      const tg = window.Telegram.WebApp;

      Telegram.WebApp.ready(); 
      tg.expand();

      const form = document.getElementById("mainForm");
      const nameInput = document.getElementById("name");
      const emailInput = document.getElementById("email");
      const phoneInput = document.getElementById("phone");
      const messageInput = document.getElementById("message");

      function validateEmail(email) {
        const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return re.test(email);
      }

      function validatePhone(phone) {
        const cleaned = phone.replace(/\D/g, "");
        return cleaned.length >= 10;
      }

      function showError(input, errorId, message) {
        input.classList.add("error");
        const errorEl = document.getElementById(errorId);
        if (message) errorEl.textContent = message;
        errorEl.classList.add("show");
      }

      function hideError(input, errorId) {
        input.classList.remove("error");
        document.getElementById(errorId).classList.remove("show");
      }

      function validateForm() {
        let isValid = true;

        if (!nameInput.value.trim()) {
          showError(nameInput, "name-error", "This field is required.");
          isValid = false;
        } else {
          hideError(nameInput, "name-error");
        }

        if (!emailInput.value.trim()) {
          showError(emailInput, "email-error", "This field is required.");
          isValid = false;
        } else if (!validateEmail(emailInput.value)) {
          showError(emailInput, "email-error", "Enter a correct email");
          isValid = false;
        } else {
          hideError(emailInput, "email-error");
        }

        if (!phoneInput.value.trim()) {
          showError(phoneInput, "phone-error", "This field is required.");
          isValid = false;
        } else if (!validatePhone(phoneInput.value)) {
          showError(phoneInput, "phone-error", "Enter a correct phone");
          isValid = false;
        } else {
          hideError(phoneInput, "phone-error");
        }

        return isValid;
      }

      function sendData() {
        if (!validateForm()) return;

        const payload = {
          name: nameInput.value.trim(),
          email: emailInput.value.trim(),
          phone: phoneInput.value.trim(),
          message: messageInput.value.trim() || undefined,
        };

        tg.sendData(JSON.stringify(payload));
        tg.close(); 
      }

      tg.MainButton.setText("Confirm");
      tg.MainButton.show();
      tg.MainButton.onClick(sendData);

      nameInput.addEventListener("blur", () => {
        if (nameInput.value.trim()) hideError(nameInput, "name-error");
      });
      emailInput.addEventListener("blur", () => {
        if (emailInput.value.trim() && validateEmail(emailInput.value))
          hideError(emailInput, "email-error");
      });
      phoneInput.addEventListener("blur", () => {
        if (phoneInput.value.trim() && validatePhone(phoneInput.value))
          hideError(phoneInput, "phone-error");
      });
    </script>
  </body>
</html>
